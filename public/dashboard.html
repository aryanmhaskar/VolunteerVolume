<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>Virginia Discovery Museum | Login</title>
		<link href="css/dashboard.css" rel="stylesheet">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
		<link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&family=Roboto+Slab:wght@100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	</head>
	<body>
		<div class="content">
			<h1>Dashboard</h1>
			<div class="row">
				<div class="shifts">
					<h3>Your Shifts</h3>
					<div>
						<div class="shift">
							<div class="shift-header">
								<h4>Today, March 1st</h4>
								<h5><i class="fa fa-pencil" aria-hidden="true"></i> Edit</h5>
							</div>
							<h5>9:00am - 10:00am</h5>
							<p>Description: I will need to be autogenerated by the backend</p>
						</div>
						<div class="shift">
							<div class="shift-header">
								<h4>Tommorow, March 2nd</h4>
								<h5><i class="fa fa-pencil" aria-hidden="true"></i> Edit</h5>
							</div>
							<h5>9:00am - 10:00am</h5>
							<p>Description: I will need to be autogenerated by the backend</p>
						</div>
					</div>
					<button onclick="window.location.href='signup.html'">Shift Sign Up</button>
				</div>
				<div class="stats">
					<h3>Summary</h3>
					<h4>Total Hours: 99</h4>
					<h4>Shifts Completed: 99</h4>
					<h4>Signed Up On: Today</h4>
					<h4></h4>
				</div>
			</div>
			<!-- <div class="calendar"> -->
			<!-- 	<iframe src="https://calendar.google.com/calendar/embed?height=600&amp;wkst=1&amp;bgcolor=%23ffffff&amp;ctz=America%2FNew_York&amp;src=Y19vOXBjajB1ZGI2ZDZvbDRpZ3VtODhwbWhuMEBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&amp;color=%23F09300&amp;title=%20&amp;showCalendars=0" style="border-width:0" width="800" height="600" frameborder="0" scrolling="no"></iframe> -->
			<!-- </div> -->
		</div>
	</body>
	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
		import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-database.js";
		
		const firebaseConfig = {
			apiKey: "AIzaSyCgkYCq7PFOcarUEtjaYVrf3QcZkLlZEEk",
			authDomain: "volunteervolume-91e20.firebaseapp.com",
			projectId: "volunteervolume-91e20",
			storageBucket: "volunteervolume-91e20.appspot.com",
			messagingSenderId: "1020304409073",
			appId: "1:1020304409073:web:81fe0ae39bc5effc130450",
			measurementId: "G-P3JWNGQ1TE",
			databaseURL: "https://volunteervolume-91e20-default-rtdb.firebaseio.com/"
		};
		
		const app = initializeApp(firebaseConfig);
		const db = getDatabase(app);
		
		const uid = sessionStorage.getItem("volunteerUID");
		const name = sessionStorage.getItem("volunteerName");
		
		if (!uid || !name) {
			alert("You are not logged in. Redirecting...");
			window.location.href = "login.html";
		} else {
			const welcomeHeader = document.createElement("h2");
			welcomeHeader.textContent = `Welcome, ${name}`;
			document.querySelector(".content").prepend(welcomeHeader);
			console.log("Logged in as:", uid);
			loadUserShifts();
		}
		
		async function loadUserShifts() {
			const shiftsDiv = document.querySelector(".shifts > div");
			shiftsDiv.innerHTML = "";
		
			const snapshot = await get(ref(db, "Shifts"));
			if (!snapshot.exists()) {
				shiftsDiv.innerHTML = "<p>No shifts available.</p>";
				return;
			}
		
			const shifts = snapshot.val();
			for (const [date, times] of Object.entries(shifts)) {
				for (const [time, roles] of Object.entries(times)) {
					for (const role of ["FrontDesk", "Gallery"]) {
						if (roles[role] && typeof roles[role] === "object" && uid in roles[role]) {
							const card = createShiftCard(date, time, role);
							shiftsDiv.appendChild(card);
						}
					}
				}
			}
		}
		
		function createShiftCard(date, time, role) {
			const shiftCard = document.createElement("div");
			shiftCard.className = "shift";
		
			const headerDiv = document.createElement("div");
			headerDiv.className = "shift-header";
		
			const [year, month, day] = date.split("-");
			const formattedDate = new Date(year, month - 1, day).toDateString();
			headerDiv.innerHTML = `<h4>${formattedDate}</h4><h5><i class="fa fa-pencil" aria-hidden="true"></i> Edit</h5>`;
		
			const timeTag = document.createElement("h5");
			timeTag.textContent = time;
		
			const desc = document.createElement("p");
			desc.textContent = `Role: ${role}`;
		
			shiftCard.appendChild(headerDiv);
			shiftCard.appendChild(timeTag);
			shiftCard.appendChild(desc);
		
			return shiftCard;
		}
		</script>		
</html>
