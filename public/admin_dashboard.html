<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Virginia Discovery Museum | Login</title>
	<link href="css/dashboard.css" rel="stylesheet">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&family=Roboto+Slab:wght@100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
	<div class="content">
		<h1>Admin Dashboard</h1>
		<div class="row">
			<div class="shifts">
				<h3>Shifts</h3>
				<div>
					<div class="shift">
						<div class="shift-header">
							<h4>Today, March 1st</h4>
							<h5><i class="fa fa-pencil" aria-hidden="true"></i> Edit</h5>
						</div>
						<h5>9:00am - 10:00am</h5>
						<p>Description: I will need to be autogenerated by the backend</p>
					</div>
					<div class="shift">
						<div class="shift-header">
							<h4>Tomorrow, March 2nd</h4>
							<h5><i class="fa fa-pencil" aria-hidden="true"></i> Edit</h5>
						</div>
						<h5>9:00am - 10:00am</h5>
						<p>Description: I will need to be autogenerated by the backend</p>
					</div>
				</div>
				<button>Create Shift</button>
			</div>

			<!-- Modal Placeholder (dynamically filled) -->
			<div id="volunteerModal" style="
	display: none;
	position: fixed;
	top: 10%;
	left: 50%;
	transform: translateX(-50%);
	background: white;
	padding: 20px;
	border-radius: 10px;
	box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
	width: 90%;
	max-width: 600px;
	z-index: 1000;
	font-family: 'Raleway', sans-serif;
">
	<h2 id="modalTitle" style="margin-top: 0;"></h2>
	<div id="modalDetails" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px 20px; margin-bottom: 20px;"></div>
	<div style="text-align: right;">
		<button id="approveBtn" style="margin-right: 10px;">Approve</button>
		<button id="denyBtn" style="margin-right: 10px;">Deny</button>
		<button id="closeModal">Close</button>
	</div>
</div>


			<div class="stats">
				<h3>Pending Requests</h3>
				<div class="requests-container" id="pendingRequests">
					<!-- Volunteer cards will be inserted here -->
				</div>
			</div>
		</div>
	</div>

	<!-- Use Firebase v9 modules via admin.js (which is a module) -->
	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
import {
  getDatabase,
  ref,
  update,
  remove,
  onValue,
  query,
  orderByChild,
  equalTo
} from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCgkYCq7PFOcarUEtjaYVrf3QcZkLlZEEk",
  authDomain: "volunteervolume-91e20.firebaseapp.com",
  projectId: "volunteervolume-91e20",
  storageBucket: "volunteervolume-91e20.appspot.com",
  messagingSenderId: "1020304409073",
  appId: "1:1020304409073:web:81fe0ae39bc5effc130450",
  measurementId: "G-P3JWNGQ1TE",
  databaseURL: "https://volunteervolume-91e20-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

document.addEventListener("DOMContentLoaded", () => {
  loadPendingRequests();
  setupModal();
});

function loadPendingRequests() {
    const container = document.getElementById("pendingRequests");
    const volunteersRef = ref(db, "Volunteers");
  
    onValue(volunteersRef, (snapshot) => {
      container.innerHTML = "";
  
      snapshot.forEach((childSnapshot) => {
        const data = childSnapshot.val();
        const id = childSnapshot.key;
  
        if (data.approval === false) {
          const card = createRequestCard(data, id);
          container.appendChild(card);
        }
      });
    });
  }
  

function createRequestCard(data, id) {
  const card = document.createElement("div");

  const birthdateStr = `${data.birthdate?.month || "?"}/${data.birthdate?.day || "?"}/${data.birthdate?.year || "?"}`;

  card.innerHTML = `
    <h4>${data.firstname} ${data.lastname}</h4>
    <p>Email: ${data.email}</p>
    <p>Phone: ${data.phone}</p>
    <p>Birthday: ${birthdateStr}</p>
    <button data-id="${id}" class="view-more">View More</button>
    <hr>
  `;

  card.querySelector(".view-more").addEventListener("click", () => showModal(data, id));
  return card;
}

function setupModal() {
  document.getElementById("closeModal").addEventListener("click", closeModal);

  // Optional: clicking outside the modal to close
  window.addEventListener("click", (e) => {
    if (e.target.id === "volunteerModal") closeModal();
  });
}



function showModal(data, id) {
	const modal = document.getElementById("volunteerModal");
	const modalTitle = document.getElementById("modalTitle");
	const modalDetails = document.getElementById("modalDetails");

	modalTitle.textContent = `${data.firstname} ${data.lastname}`;

	modalDetails.innerHTML = `
		<p><strong>Email:</strong> ${data.email}</p>
		<p><strong>Phone:</strong> ${data.phone}</p>
		<p><strong>Birthdate:</strong> ${data.birthdate?.month}/${data.birthdate?.day}/${data.birthdate?.year}</p>
		<p><strong>Address:</strong> ${data.address}, ${data.city}, ${data.state} ${data.zipcode}</p>
		<p><strong>Status:</strong> ${data.status}</p>
		<p><strong>Vaccinated:</strong> ${data.vaccinated}</p>
		<p><strong>Criminal Record:</strong> ${data.criminalRecord}</p>
		<p><strong>Explain Record:</strong> ${data.explainRecord || 'N/A'}</p>
		<p><strong>Source:</strong> ${data.source}</p>
		<p><strong>Other Source:</strong> ${data.otherSource || 'N/A'}</p>
		<p><strong>Volunteer Experience:</strong> ${data.volExperience}</p>
		<p><strong>Employment Experience:</strong> ${data.empExperience}</p>
		<p><strong>Reference:</strong> ${data.reference}</p>
		<p><strong>Hobbies:</strong> ${data.hobbies}</p>
		<p style="grid-column: span 2;"><strong>Why Volunteer:</strong> ${data.whyVolunteer}</p>
	`;

	document.getElementById("approveBtn").onclick = () => approveVolunteer(id);
	document.getElementById("denyBtn").onclick = () => denyVolunteer(id);
	modal.style.display = "block";
}


function closeModal() {
  const modal = document.getElementById("volunteerModal");
  modal.style.display = "none";
}

function approveVolunteer(id) {
    update(ref(db, `Volunteers/${id}`), { approval: true })
      .then(() => {
        closeModal();
        loadPendingRequests();
      })
      .catch((err) => console.error("Error approving:", err));
  }
  
  function denyVolunteer(id) {
    remove(ref(db, `Volunteers/${id}`))
      .then(() => {
        closeModal();
        loadPendingRequests();
      })
      .catch((err) => console.error("Error denying:", err));
  }
	</script>
</body>
</html>
